<html lang="pl-pl">
<head>
    <title>My first X3DOM page</title>
    <script type='text/javascript' src='http://www.x3dom.org/download/x3dom.js'></script>
    <link rel='stylesheet' type='text/css' href='http://www.x3dom.org/download/x3dom.css'/>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <meta charset="UTF-8">
</head>
<body>
<x3d>
    <scene id="content">
        <Environment id='myEnv' SSAO='true' SSAOamount='0.5' SSAOblurDepthTreshold='1.0' SSAOradius='0.7'
                     gammaCorrectionDefault="linear"></Environment>
        <navigationInfo type='"examine" "any"' headlight="false" id="navType"></navigationInfo>

        <!--Viewports-->

        <Viewpoint position="19.54189 1.67126 -3.43897" orientation="-0.05584 0.99813 0.02471 1.74510" zNear="2.79038"
                   zFar="43.42864" description="defaultX3DViewpointNode"></Viewpoint>

        <Viewpoint id="walkingView" position="0.40672 0.57194 9.97534" orientation="-0.81516 0.57906 -0.01422 0.07025"
                   zNear="0.00317" zFar="31.70807" description="defaultX3DViewpointNode"></Viewpoint>

        <Viewpoint id="topView" position="0.27643 28.04095 0.34033" orientation="-0.57008 0.58026 0.58163 2.08624" zNear="2.79038"
                   zFar="43.42864" description="defaultX3DViewpointNode"></Viewpoint>


        <background skyColor="0 0 0"></background>
        <!--Lights-->

        <directionalLight id="directional" direction='-1 -1 0' on="TRUE" intensity='2.0' shadowIntensity="0.5">
        </directionalLight>
        <SpotLight id='spot1' on="TRUE" beamWidth='5' color='0 0 1' location='3 2 -1' direction="-4 0 3"
                   cutOffAngle='0.78' radius='5' shadowIntensity="0.5"></SpotLight>
        <SpotLight id='spot2' on="TRUE" beamWidth='5' color='1 0 0' location='8 2 -1' direction="0 -1 1"
                   cutOffAngle='0.78' radius='5' shadowIntensity="0.5"></SpotLight>
        <pointLight id='point' on='TRUE' intensity='1' ambientIntensity='1' shadowIntensity="0.5"></pointLight>

        <!--Houses-->
        <Group DEF='House'>
            <!--Roof-->
            <Transform translation="0 2.5 0" rotation="0 1 0 0.785398163"> <!-- Rotate by 45 degrees-->
                <Shape DEF='Roof'>
                    <Appearance>
                        <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>
                            <ImageTexture containerField='diffuseTexture' url="./assets/roofTexture.jpg"/>
                        </CommonSurfaceShader>
                    </Appearance>
                    <Cone bottomRadius="1.8" height="1" subdivision="4">
                    </Cone>
                </Shape>
            </Transform>
            <!--Building-->
            <Transform translation="0 1 0">
                <Shape>
                    <Appearance>
                        <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>

                            <ImageTexture containerField='diffuseTexture' url="./assets/wallTexture.jpg"/>
                        </CommonSurfaceShader>
                    </Appearance>
                    <Cylinder/>
                </Shape>
            </Transform>
        </Group>
        <!--Floor-->
        <Transform translation="0 -0.05 0" rotation="1 0 0 -1.57">
            <Shape>
                <Appearance>
                    <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>

                        <ImageTexture containerField='diffuseTexture' url="./assets/grassTexture.jpg"/>
                    </CommonSurfaceShader>
                </Appearance>

                <plane size="23 23"/>
            </Shape>
        </Transform>

        <!--Mirror-->
        <Transform DEF="mirrorTrans" translation="-12 0 0" rotation="0 1 0 1.57079633">
            <Shape id='myMirrorShape' DEF='myMirrorShape'>
                <IndexedFaceSet solid="false" coordIndex='0 1 2 3 -1'>
                    <Coordinate point='-6 -6 0, 6 -6 0, 6 6 0, -6 6 0'></Coordinate>
                    <TextureCoordinate point='1 1, 0 1, 0 0, 1 0'></TextureCoordinate>
                </IndexedFaceSet>
                <Appearance DEF='rtApp'>
                    <RenderedTexture id='myRenderedTexture' update='always' dimensions='512 512 4'
                                     repeatS='false' repeatT='false' >
                        <Shape USE='myMirrorShape' containerField='excludeNodes' ></Shape>
                        <Background skyColor='1 1 1' groundColor='1 1 1' containerField='background'></Background>
                        <Viewpoint id='myMirrorTextureViewPoint' zNear="0.1" zFar="1000" containerField='viewpoint' ></Viewpoint>
                    </RenderedTexture>
                </Appearance>
            </Shape>
        </Transform>

        <TimeSensor DEF='ts' cycleInterval='10' loop='true' startTime='0'></TimeSensor>
        <OrientationInterpolator DEF='oiMirror' key='0 0.25 0.5' keyValue='1 0 0 0  0 1 0 1  0 1 0 -1  1 0 0 0  1 0 0 0.5'></OrientationInterpolator>
        <ROUTE fromNode='ts' fromField='fraction_changed' toNode='oiMirror' toField='set_fraction'></ROUTE>
        <ROUTE fromNode='oiMirror' fromField='value_changed' toNode='mirrorTrans' toField='set_rotation'></ROUTE>


    </scene>
</x3d>
<div id="tools" style="width: 70vw; margin-top: 10px">
    <div id="buttons">
        <button onclick="setGameMode()">Poruszanie się strzałkami</button>
        <button onclick="setTopView()">Widok z lotu ptaka</button>
    </div>

    <h5>Światła</h5>
    <input id="directionalLight" type="checkbox" checked="true" onclick="lightSwitch('directional')">
    <label for="directionalLight">Nieruchome światło kierunkowe</label>

    <input id="spot1Light" type="checkbox" checked="true" onclick="lightSwitch('spot1')">
    <label for="spot1Light">Światło reflektorowe 1</label>

    <input id="spot2Light" type="checkbox" checked="true" onclick="lightSwitch('spot2')">
    <label for="spot2Light">Światło reflektorowe 2</label>

    <input id="pointLight" type="checkbox" checked="true" onclick="lightSwitch('point')">
    <label for="pointLight">Poruszające się światło punktowe</label>

    <input id="headlight" type="checkbox" onclick="headlight()">
    <label for="headlight">Headlight</label>

    <h5>Cienie</h5>
    <input id="directionalShadow" type="checkbox" checked="true" onclick="shadowSwitch('directional')">
    <label for="directionalShadow">Nieruchome światło kierunkowe</label>

    <input id="spot1Shadow" type="checkbox" checked="true" onclick="shadowSwitch('spot1')">
    <label for="spot1Shadow">Światło reflektorowe 1</label>

    <input id="spot2Shadow" type="checkbox" checked="true" onclick="shadowSwitch('spot2')">
    <label for="spot2Shadow">Światło reflektorowe 2</label>

    <input id="pointShadow" type="checkbox" checked="true" onclick="shadowSwitch('point')">
    <label for="pointShadow">Poruszające się światło punktowe</label>

    <h5>Środowisko</h5>
    <input id="SSAO" type="checkbox" checked="true" onclick="SSAOSwich()">
    <label for="SSAO">SSAO</label>

    <input id="gamma" type="checkbox" checked="true" onclick="gammaSwitch()">
    <label for="gamma">Korekcja Gamma</label>

</div>
<script>

    function switcher(id, attr) {
        var elem = document.getElementById(id);
        if (elem.getAttribute(attr) != 'TRUE')
            elem.setAttribute(attr, 'TRUE');
        else
            elem.setAttribute(attr, 'FALSE');
    }

    function lightSwitch(id) {
        switcher(id, 'on');
    }

    function SSAOSwich() {
        switcher('myEnv', 'SSAO');
    }

    function gammaSwitch(){
        var h = document.getElementById("myEnv");
        if (h.getAttribute('gammaCorrectionDefault') == 'linear')
            h.setAttribute('gammaCorrectionDefault', 'none');
        else
            h.setAttribute('gammaCorrectionDefault', 'linear');
    }

    function shadowSwitch(id) {
        var light = document.getElementById(id);
        if (light.getAttribute('shadowIntensity') == '0')
            light.setAttribute('shadowIntensity', '0.5');
        else
            light.setAttribute('shadowIntensity', '0');
    }

    function headlight() {
        var h = document.getElementById("navType");
        if (h.getAttribute('headlight') == 'true')
            h.setAttribute('headlight', 'false');
        else
            h.setAttribute('headlight', 'true');
    }

    function createHouses() {
        var scene = document.getElementById("content");

        // Houses from right and left from original
        for (let i = -9; i <= 9; i += 3) {
            for (let j = -9; j <= 9; j += 3) {
                let transform = document.createElement("Transform");
                let house = document.createElement("Shape");
                house.setAttribute("USE", "House");
                // Creating spaces
                i = i === 0 ? i + 3 : i;
                j = j === 0 ? j + 3 : j;
                transform.setAttribute("translation", `${i} 0 ${j}`);
                transform.appendChild(house);
                scene.appendChild(transform);
            }
        }
    }

    function moveLighting() {
        let interval = setInterval(myTimer, 10);
        let theta = 0;  // angle that will be increased each loop
        let r = 10;

        function myTimer() {
            let h = 0;     // x coordinate of circle center
            let k = 0;      // y coordinate of circle center
            let step = 0.01;  // amount to add to theta each time (degrees)

            if (theta < 2 * Math.PI) {
                theta += step
            }
            if (theta === 360) {
                theta = 0;
            }
            let x = h + r * Math.cos(theta);
            let z = k + r * Math.sin(theta);

            var newPos = new x3dom.fields.SFVec3f(x, 10, z);

            //Set the newly created array as new position for the second ball
            document.getElementById("point").setAttribute('location', newPos.toString());
            theta += step;
        }
    }

    function setGameMode() {
        document.getElementById('navType').setAttribute("type", "game");
        document.getElementById('walkingView').setAttribute('set_bind', 'true');
    }

    function setTopView(){
        document.getElementById('topView').setAttribute('set_bind', 'true');
    }

    function init() {
        createHouses();
        moveLighting();
    }

    init();

</script>
</body>
</html>