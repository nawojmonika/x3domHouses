<html lang="pl-pl">
<head>
    <title>My first X3DOM page</title>
    <script type='text/javascript' src='http://www.x3dom.org/download/x3dom.js'></script>
    <link rel='stylesheet' type='text/css' href='http://www.x3dom.org/download/x3dom.css'/>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <meta charset="UTF-8">
</head>
<body>
<x3d>
    <scene id="content">
        <Environment id='myEnv' SSAO='true' SSAOamount='0.5' SSAOblurDepthTreshold='1.0' SSAOradius='0.7'
                     gammaCorrectionDefault="linear"></Environment>
        <navigationInfo type='"examine" "any"' headlight="false" id="navType"></navigationInfo>
        <!--ViewPoints-->
        <Viewpoint position="27.01942 11.04116 -0.72399" orientation="-0.19687 0.96414 0.17800 1.62916" zNear="2.79038"
                   zFar="43.42864" description="defaultX3DViewpointNode"></Viewpoint>

        <Viewpoint id="walkingView" position="-3.01719 1.04723 14.28986" orientation="-0.33571 -0.93794 0.08698 0.22072"
                   zNear="0.00431" zFar="43.07147" description="defaultX3DViewpointNode"></Viewpoint>

        <Viewpoint id="topView" position="6.89130 33.18133 0.14439" orientation="-0.54409 0.65114 0.52914 1.96379" zNear="2.79038"
                   zFar="43.42864" description="defaultX3DViewpointNode"></Viewpoint>

        <background skyColor="0 0 0"></background>
        <!--Lights-->
        <directionalLight id="directional" on="TRUE" color="0 0 1" direction="-1 -1 0"
                          shadowIntensity="0.5"></directionalLight>
        <SpotLight id='spot1' on="TRUE" beamWidth='5' color='0 1 0' location='5 2 5' cutOffAngle='0.78'
                   direction="0 0 -1"
                   radius='5' shadowIntensity="0.5"></SpotLight>
        <SpotLight id='spot2' on="TRUE" beamWidth='5' color='1 0 0' location='8 2 5' cutOffAngle='0.78'
                   direction="1 0 0"
                   radius='5' shadowIntensity="0.5"></SpotLight>
        <pointLight id='point' on='TRUE' intensity='1' ambientIntensity='1' shadowIntensity="0.5"></pointLight>

        <!--Houses-->
        <Group DEF='House'>
            <!--Roof-->
            <Transform translation="0 2.5 0" rotation="0 1 0 0">
                <Shape DEF='Roof'>
                    <Appearance>
                        <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>
                            <ImageTexture containerField='diffuseTexture' url="./assets/roofTexture.jpg"/>
                        </CommonSurfaceShader>
                    </Appearance>
                    <Cone bottomRadius="1.8" height="1.5">
                    </Cone>
                </Shape>
            </Transform>
            <!--Building-->
            <Transform translation="0 1 0">
                <Shape>
                    <Appearance>
                        <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>

                            <ImageTexture containerField='diffuseTexture' url="./assets/wallTexture.jpg"/>
                        </CommonSurfaceShader>
                    </Appearance>
                    <Box/>
                </Shape>
            </Transform>
        </Group>
        <!--Floor-->
        <Transform translation="0 -0.05 0" rotation="1 0 0 -1.57">
            <Shape>
                <Appearance>
                    <CommonSurfaceShader diffuseFacor='1 1 1' specularFactor='1 1 1' shininessFactor='1'>

                        <ImageTexture containerField='diffuseTexture' url="./assets/grassTexture.jpg"/>
                    </CommonSurfaceShader>
                </Appearance>
                <plane size="30 30"/>
            </Shape>
        </Transform>
    </scene>
</x3d>
<div id="tools" style="width: 60vw; margin-top: 10px">
    <div id="buttons">
        <button onclick="setGameMode()">Poruszanie się strzałkami</button>
        <button onclick="setTopView()">Widok z lotu ptaka</button>
    </div>

    <h5>Światła</h5>
    <input id="directionalLight" type="checkbox" checked="true" onclick="lightSwitch('directional')">
    <label for="directionalLight">Nieruchome światło kierunkowe</label>

    <input id="spot1Light" type="checkbox" checked="true" onclick="lightSwitch('spot1')">
    <label for="spot1Light">Światło reflektorowe 1</label>

    <input id="spot2Light" type="checkbox" checked="true" onclick="lightSwitch('spot2')">
    <label for="spot2Light">Światło reflektorowe 2</label>

    <input id="pointLight" type="checkbox" checked="true" onclick="lightSwitch('point')">
    <label for="pointLight">Poruszające się światło punktowe</label>

    <input id="headlight" type="checkbox" onclick="headlight()">
    <label for="headlight">Headlight</label>

    <h5>Cienie</h5>
    <input id="directionalShadow" type="checkbox" checked="true" onclick="shadowSwitch('directional')">
    <label for="directionalShadow">Nieruchome światło kierunkowe</label>

    <input id="spot1Shadow" type="checkbox" checked="true" onclick="shadowSwitch('spot1')">
    <label for="spot1Shadow">Światło reflektorowe 1</label>

    <input id="spot2Shadow" type="checkbox" checked="true" onclick="shadowSwitch('spot2')">
    <label for="spot2Shadow">Światło reflektorowe 2</label>

    <input id="pointShadow" type="checkbox" checked="true" onclick="shadowSwitch('point')">
    <label for="pointShadow">Poruszające się światło punktowe</label>

    <h5>Środowisko</h5>
    <input id="SSAO" type="checkbox" checked="true" onclick="SSAOSwich()">
    <label for="SSAO">SSAO</label>

    <input id="gamma" type="checkbox" checked="true" onclick="gammaSwitch()">
    <label for="gamma">Korekcja Gamma</label>

</div>
<script>
    function switcher(id, attr) {
        var elem = document.getElementById(id);
        if (elem.getAttribute(attr) != 'TRUE')
            elem.setAttribute(attr, 'TRUE');
        else
            elem.setAttribute(attr, 'FALSE');
    }

    function lightSwitch(id) {
        switcher(id, 'on');
    }

    function SSAOSwich() {
        switcher('myEnv', 'SSAO');
    }

    function gammaSwitch() {
        var h = document.getElementById("myEnv");
        if (h.getAttribute('gammaCorrectionDefault') == 'linear')
            h.setAttribute('gammaCorrectionDefault', 'none');
        else
            h.setAttribute('gammaCorrectionDefault', 'linear');
    }

    function shadowSwitch(id) {
        var light = document.getElementById(id);
        if (light.getAttribute('shadowIntensity') == '0')
            light.setAttribute('shadowIntensity', '0.5');
        else
            light.setAttribute('shadowIntensity', '0');
    }

    function setTopView(){
        document.getElementById('topView').setAttribute('set_bind', 'true');
    }

    function headlight() {
        var h = document.getElementById("navType");
        if (h.getAttribute('headlight') == 'true')
            h.setAttribute('headlight', 'false');
        else
            h.setAttribute('headlight', 'true');
    }

    function createHouses() {
        var scene = document.getElementById("content");

        // Houses from right and left from original
        for (let i = -12; i <= 12; i += 6) {
            for (let j = -12; j <= 12; j += 6) {
                let transform = document.createElement("Transform");
                let house = document.createElement("Shape");
                house.setAttribute("USE", "House");
                transform.setAttribute("translation", `${i} 0 ${j}`);
                transform.appendChild(house);
                scene.appendChild(transform);
            }
        }
    }

    function moveLighting() {
        let interval = setInterval(myTimer, 10);
        let theta = 0;  // angle that will be increased each loop
        let r = 10;

        function myTimer() {
            let h = 0;     // x coordinate of circle center
            let k = 0;      // y coordinate of circle center
            let step = 0.01;  // amount to add to theta each time (degrees)

            if (theta < 2 * Math.PI) {
                theta += step
            }
            if (theta === 360) {
                theta = 0;
            }
            let x = h + r * Math.cos(theta);
            let z = k + r * Math.sin(theta);

            var newPos = new x3dom.fields.SFVec3f(x, 10, z);

            //Set the newly created array as new position for the second ball
            document.getElementById("point").setAttribute('location', newPos.toString());
            theta += step;
        };
    };

    function setGameMode() {
        document.getElementById('navType').setAttribute("type", "game");
        document.getElementById('walkingView').setAttribute('set_bind', 'true');
    }

    function init() {
        createHouses();
        moveLighting();
    }

    init();

</script>
</body>
</html>